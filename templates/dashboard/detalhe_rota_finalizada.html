{% extends 'base.html' %}

{% block sidebar %}
{% if is_gestor %}
{% include "includes/sidebar_gerente_admin.html" %}
{% else %}
<ul class="nav flex-column">
    <li class="nav-item">
        <a class="nav-link" href="{% url 'dashboard:funcionario' %}">
            <i class="bi bi-speedometer2"></i> Dashboard
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'dashboard:meus_pedidos' %}">
            <i class="bi bi-list-task"></i> Meus Pedidos
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'dashboard:pedidos_disponiveis' %}">
            <i class="bi bi-play-circle"></i> Pedidos Disponíveis
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'dashboard:expedicao_motoboy' %}">
            <i class="bi bi-truck"></i> Rota Motoboy
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'dashboard:expedicao_sedex' %}">
            <i class="bi bi-box-seam"></i> Envio Sedex
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link{% if request.resolver_match.url_name == 'rotas_finalizadas' %} active{% endif %}" href="{% url 'dashboard:rotas_finalizadas' %}">
            <i class="bi bi-archive"></i> Rotas Finalizadas
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link{% if request.resolver_match.url_name == 'historico_etapas' %} active{% endif %}" href="{% url 'dashboard:historico_etapas' %}">
            <i class="bi bi-clock-history"></i> Histórico de Etapas
        </a>
    </li>
</ul>
{% endif %}
{% endblock %}

{% block content %}
<div class="mb-4">
    <h1 class="h3 fw-bold"><i class="bi bi-archive text-primary"></i> Detalhes da Rota Finalizada</h1>
    <p class="mb-2"><strong>Funcionário:</strong> {{ historico.funcionario.get_full_name|default:historico.funcionario.username }}</p>
    <p><strong>Data/Hora Finalização:</strong> {{ historico.timestamp_fim|date:'d/m/Y H:i' }}</p>
</div>

<div class="card mb-4">
    <div class="card-header bg-primary text-white">
        <strong>Pedidos desta Rota</strong>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>IDPEDIDO</th>
                        <th>IDPEDIDOWEB</th>
                        <th>Nome</th>
                        <th>Tipo</th>
                        <th>QTD</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong class="text-primary">{{ historico.pedido.id_api }}</strong></td>
                        <td><code class="text-muted">{{ historico.pedido.id_pedido_api|default:"-" }}</code></td>
                        <td><code class="text-muted">{{ historico.pedido.id_pedido_web|default:"-" }}</code></td>
                        <td><small title="{{ historico.pedido.nome }}" style="word-wrap: break-word; white-space: normal; max-width: 200px; display: inline-block;">{{ historico.pedido.nome }}</small></td>
                        <td>
                            {% if historico.pedido.tipo_identificado %}
                            <span class="badge bg-info">{{ historico.pedido.tipo_identificado|upper }}</span>
                            {% else %}
                            <span class="badge bg-secondary">-</span>
                            {% endif %}
                        </td>
                        <td><span class="badge bg-light text-dark">{{ historico.pedido.quantidade }}</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<a href="{{ request.META.HTTP_REFERER|default:'javascript:history.back()' }}" class="btn btn-secondary">
    <i class="bi bi-arrow-left"></i> Voltar
</a>
{% endblock %}
